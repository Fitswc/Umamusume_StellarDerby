##########################
#   Golden Family Crisis #
#	Written by Tom/Eu/F  #
#	Remake by F			 #
#   2023/8/31            #
##########################
namespace = uma_crisis

#country_event = {
#	id = uma_crisis.10000
#	hide_window = yes
#	is_triggered_only = yes
#	trigger = {
#		is_ai = no
#		has_authority = auth_trainingcenter ####
#	}
#
#	immediate = {
#		log = "Uma-GoldShip Invasion Will Happened in 150 years +- 220 days"
#		random_country = {
#			limit = {
#				has_country_flag = is_uma_country_flag
#			}
#			country_event = { id = uma_crisis.00 days =54050  random = 220 }
#		}
#	}
#}

country_event = {
	id = uma_crisis.10000
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
	}
	immediate = {
		log = "Uma-GoldShip Invasion Will Happened"
		random_country = {
			limit = {
				has_authority = auth_trainingcenter
			}
			country_event = {
				id = uma_crisis.00
				days = 100
			}
		}
	}
}

country_event = {
	id = uma_crisis.00
	title = uma_crisis.00.title
	desc = uma_crisis.00.desc
	picture = GFX_evt_juggernaut

	is_triggered_only = yes

	trigger = {
	}

	immediate = {
		log = "Uma-GoldShip Invasion's Prologue event happened"
		set_country_flag = uma_starting_event
		save_event_target_as = uma_owner_country
		capital_scope = {
			solar_system = {
				random_system_planet = {
					limit = {
						is_capital = no
						is_asteroid = no
						is_star = no
						is_moon = no
						NOT = { is_planet_class = pc_gas_giant }
					}
					save_event_target_as = gold_ship_planet
				}
			}
		}
		owner_species = { save_event_target_as = owner_species }
		create_country = {
			name = "NAME_Gold_Ship_Fleet" #黄金家族
			species = root.species
			type = uma_faction
			name_list = UMAname
			auto_delete = no
			flag = {
				icon = {
					category = "uiu_flags"
					file = "uiu_flags01.dds"
				}
				background = {
					category = "backgrounds"
					file = "circle.dds"
				}
				colors = {
					"red_orange"
					"blue"
					"null"
					"null"
				}
			}
			effect = {
				set_country_flag = gold_ship
				establish_communications_no_message = root
				establish_contact = { who = root location = root.capital_scope }
				save_global_event_target_as = uma_gold_invasion_family_country
				create_ship_design = { design = "NAME_Void_Shaper" }
				add_ship_design = last_created_design
				create_ship_design = { design = "NAME_Unbidden_Anchor" }
				add_ship_design = last_created_design
				create_ship_design = { design = "NAME_Unbidden_Starbase" }
				add_ship_design = last_created_design
				create_fleet = {
					name = "goldi_ship_object" #神秘的船
					effect = {
						set_owner = prev
						create_ship_design = {
							design = "NAME_gold_Fleet"
						}
						create_ship = {
							name = "NAME_Xiaojin"
							design = last_created_design
							effect = {
								set_ship_flag = Gin_ship
								set_disable_at_health = 0.05
								save_event_target_as = Gin_ship
							}
						}
						set_location = event_target:gold_ship_planet
						set_fleet_stance = passive
						queue_actions = {
							repeat = {
								wait = {
									duration = 100
								}
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = "uma_crisis.00.a"
		begin_event_chain = {
			event_chain = "gold_counterattack"
			target = ROOT
		}
			hidden_effect = {
			enable_special_project = {
				name = "FIRST_TEMPTATION_OF_ENGINEER"
				location = event_target:Gin_ship
				owner = root
			}
		}
	}
}

country_event = {
	id = uma_crisis.101
	title = uma_crisis.101.title
	desc = uma_crisis.101.desc
	picture = GFX_evt_glitchy_matrix
	trackable = yes

	is_triggered_only = yes
	trigger = {}
	option = {
		name = uma_crisis.101.a
		#        from = {}
		hidden_effect = {
			enable_special_project = {
				name = "UMA_STOP_BILIBILI"
				location = event_target:Gin_ship
				owner = root
			}
		}
	}
}


#奇怪的波动
##建议是country_event
country_event = {
	id = uma_crisis.11
	title = uma_crisis.11.title
	desc = uma_crisis.11.desc
	picture = GFX_evt_crisis_defeated
	trackable = yes

	is_triggered_only = yes
	trigger = {}
	option = {
		name = uma_crisis.11.a
		#        from = {}
		hidden_effect = {
			enable_special_project = {
				name = "UMA_STOP_BILIBILI"
				location = event_target:Gin_ship
				owner = root
			}
		}
	}
}

#特殊项目完成（异常波动）
country_event = {
	id = uma_crisis.12
	title = uma_crisis.12.title
	desc = uma_crisis.12.desc
	picture = GFX_evt_intelligence_report
	trackable = yes
	is_triggered_only = yes

	option = {
		name = uma_crisis.12.a
		country_event = { id = uma_crisis.13 }
	}
	option = {
		name = uma_crisis.12.b
		country_event = { id = uma_crisis.14 }
	}

}

#F注：外交菜单等通信接入一般使用country_event（scope在country）

#选项1
country_event = {
	id = uma_crisis.13
	title = uma_crisis.13.title
	desc = uma_crisis.13.desc
	is_triggered_only = yes
	diplomatic = yes
	force_open = yes
	picture_event_data = {
		portrait = 07c
		room = extradimensional_room
	}
	option = {
		name = uma_crisis.13.a
		hidden_effect = {
			owner = {
				country_event = {
					id = uma_crisis.1000
				}
			}
		}
	}
}

#选项2
country_event = {
	id = uma_crisis.14
	title = uma_crisis.13.title
	desc = uma_crisis.14.desc
	is_triggered_only = yes
	diplomatic = yes
	force_open = yes
	picture_event_data = {
		portrait = GS
		room = extradimensional_room
	}
	option = {
		name = uma_crisis.14.a
		hidden_effect = {
			owner = {
				country_event = {
					id = uma_crisis.1000
				}
			}
		}
	}
}

#不处理
country_event = {
	id = uma_crisis.15
	title = uma_crisis.13.title
	desc = uma_crisis.15.desc
	is_triggered_only = yes
	diplomatic = yes
	force_open = yes
	picture_event_data = {
		portrait = GS
		room = extradimensional_room
	}
	option = {
		name = uma_crisis.15.a
		hidden_effect = {
			owner = {
				country_event = {
					id = uma_crisis.1000
				}
			}
		}
	}
}

country_event = {
	id = uma_crisis.1000
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		log = "Uma-GoldShip Invasion Happeneded -Part 1 Goldship"
		#Portal Holder
		create_country = {
			name = "NAME_gold_Portal_Holder"
			type = portal_holder
			flag = {
				icon = {
					category = "uiu_flags"
					file = "uiu_flags01.dds"
				}
				background = {
					category = "backgrounds"
					file = "circle.dds"
				}
				colors = {
					"indigo"
					"blue"
					"null"
					"null"
				}
			}
			effect = {
				save_global_event_target_as = gold_portal_holder
				every_playable_country = {
					establish_communications_no_message = event_target:gold_portal_holder
				}
			}
		}
		set_global_flag = uma_gold_invasion_happened

		random_system_within_border = {
			limit = {
				owner = {
					has_authority = auth_trainingcenter
				}
				distance = {
#					source = event_target:uma_player_umamusume_empire_system
					source = root.solar_system
					min_jumps = 1
					max_jumps = 10
				}
				count_neighbor_system = {
					count > 2
				}
				NOR = {
					AND = {
						exists = owner
						owner = {
							OR = {
								is_country_type = fallen_empire
								is_country_type = awakened_fallen_empire
							}
						}
					}
				}
			}
			set_star_flag = uma_gold_invasion_spawn_system
			save_event_target_as = uma_gold_invasion_spawn_system

			random_system_planet = {
				create_species = {
					name = "NAME_goldship_species"
					class = umamusume
					namelist = UMAname
					portrait = umamusume
					traits = random
					effect = { save_event_target_as = goldship_species }
				}

				create_country = {
					name = "NAME_Goldship"
					type = "goldshipsentai"
					species = event_target:goldship_species
					name_list = "UMAname"
					flag = {
						icon = {
							category = "uiu_flags"
							file = "uiu_flags01.dds"
						}
						background = {
							category = "backgrounds"
							file = "circle.dds"
						}
						colors = {
							"indigo"
							"blue"
							"null"
							"null"
						}
					}
					effect = {
						create_ship_design = { design = "NAME_Void_Shaper" }
						add_ship_design = last_created_design
						create_ship_design = { design = "NAME_Unbidden_Anchor" }
						add_ship_design = last_created_design
						create_ship_design = { design = "NAME_Unbidden_Starbase" }
						add_ship_design = last_created_design
						save_global_event_target_as = goldship_crisis_country
						establish_communications_no_message = event_target:gold_portal_holder
						set_faction_hostility = {
							target = event_target:gold_portal_holder
							set_hostile = no
						}
						set_graphical_culture = uma_fallen_empire
						#						save_event_target_as = goldshi
						set_country_flag = gold_ship_crisis_country
						set_aggro_range = 1000
						set_aggro_range_measure_from = self
					}
				}

				event_target:goldship_crisis_country = {
					create_fleet = {
						name = "NAME_GoldShip_Portal"
						effect = {
							set_fleet_flag = gold_ship_portal_fleet
							set_owner = PREV
							create_ship = {
								design = "NAME_Unbidden_Portal"
								graphical_culture = "extra_dimensional_01"
								effect = {
									set_ship_flag = gold_ship_portal
								}
							}
							set_location = {
								target = PrevPrev
								distance = 50
								angle = random
							}
							save_global_event_target_as = gold_ship_portal
							set_global_flag = uma_gold_ships_portal_still_here
							set_event_locked = yes #击破不能
						}
					}
					uma_mid_crisis_ship_creator_goldship = yes #舰队创建
					uma_mid_crisis_ship_creator_goldship = yes #舰队创建
					uma_mid_crisis_ship_creator_goldship = yes #舰队创建
					uma_mid_crisis_ship_creator_goldship = yes
					uma_mid_crisis_ship_creator_goldship = yes #舰队创建
					uma_mid_crisis_ship_creator_goldship = yes #舰队创建
					uma_mid_crisis_ship_creator_goldship = yes
					uma_mid_crisis_constructor_creator_gold= yes #建造船
					uma_mid_crisis_constructor_creator_gold= yes #建造船
					uma_mid_crisis_constructor_creator_gold= yes #建造船
					country_event = { id = uma_crisis.520 days = 200 }
				}
			}
			if = {
				limit = { exists = starbase }
				starbase = { fleet = { destroy_fleet = this } }
			}
			create_starbase = {
				size = starbase_exd
				owner = event_target:goldship_crisis_country
			}
			star = {
				create_ambient_object = {
					type = "extradimensional_2"
					location = this
				}
				last_created_ambient_object = {
					set_ambient_object_flag = Goldship_system_effect_2
					save_event_target_as = Goldship_system_effect_2
					set_location = {
						target = prev
						distance = 0
						angle = random
					}
				}
			}

		}
		every_playable_country = {
			limit = {
				is_ai = no
			}
			country_event = { id = uma_crisis.1008 }
		}
	}
}

country_event = {
	id = uma_crisis.1008
	title = "uma_crisis.1008.name"
	desc = "uma_crisis.1008.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_alien_signal

	is_triggered_only = yes

	option = {
		name = uma_crisis.1008.a
		hidden_effect = {
			country_event = { id = uma_crisis.2000 days = 200  }
		}
	}
}

#金船造船循环
country_event = {
	id = uma_crisis.520
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_global_flag = uma_gold_invasion_happened
		has_global_flag = uma_gold_ships_portal_still_here
	}

	immediate = {
		log = "Uma-GoldShip Invasion Happeneded -Part 1 Goldship Ship building cycle happened"
		event_target:goldship_crisis_country = {
			# 如果船的战力很强，打破，check later
			if = {
				limit = {
					fleet_power > 10000
				}
				country_event = { id = uma_crisis.520 days = 200 }
				break = yes
			}
			uma_mid_crisis_ship_creator_goldship = yes
			uma_mid_crisis_constructor_creator_gold = yes
			country_event = { id = uma_crisis.520 days = 200 }
		}
	}
}


country_event = {
	id = uma_crisis.2000
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		log = "Uma-GoldShip Invasion Happeneded -Part 2 NakaYama"
		#Portal Holder
		create_country = {
			name = "NAME_NakaYama_Portal_Holder"
			type = portal_holder
			flag = {
				icon = {
					category = "uiu_flags"
					file = "uiu_flags01.dds"
				}
				background = {
					category = "backgrounds"
					file = "circle.dds"
				}
				colors = {
					"indigo"
					"blue"
					"null"
					"null"
				}
			}
			effect = {
				save_global_event_target_as = naka_portal_holder
				every_playable_country = {
					establish_communications_no_message = event_target:naka_portal_holder
				}
			}
		}

		random_system = {
			limit = {
				has_star_flag = uma_gold_invasion_spawn_system
			}
			random_neighbor_system = {
				limit = {
					NOR = {
						is_capital_system = yes
						is_star_class = sc_pulsar
						is_star_class = sc_binary_1
						AND = {
							exists = owner
							owner = {
								OR = {
									is_country_type = fallen_empire
									is_country_type = awakened_fallen_empire
								}
							}
						}

					}
				}
				set_star_flag = uma_naka_invasion_spawn_system
				save_event_target_as = uma_naka_invasion_spawn_system

				random_system_planet = {
					create_species = {
						name = "NAME_nakayama_species"
						class = umamusume
						namelist = UMAname
						portrait = umamusume
						traits = random
						effect = { save_event_target_as = nakayama_species }
					}

					create_country = {
						name = "NAME_Nakayama"
						type = "nakayamasentai"
						species = event_target:nakayama_species
						name_list = "UMAname"
						flag = {
							icon = {
								category = "uiu_flags"
								file = "uiu_flags01.dds"
							}
							background = {
								category = "backgrounds"
								file = "circle.dds"
							}
							colors = {
								"indigo"
								"blue"
								"null"
								"null"
							}
						}
						effect = {
							create_ship_design = { design = "NAME_Void_Shaper" }
							add_ship_design = last_created_design
							create_ship_design = { design = "NAME_Unbidden_Anchor" }
							add_ship_design = last_created_design
							create_ship_design = { design = "NAME_Unbidden_Starbase" }
							add_ship_design = last_created_design
							save_global_event_target_as = naka_crisis_country
							establish_communications_no_message = event_target:naka_portal_holder
							set_faction_hostility = {
								target = event_target:naka_portal_holder
								set_hostile = no
							}
							set_faction_hostility = {
								target = event_target:goldship_crisis_country
								set_friendly = no
								set_hostile = yes
							}
							set_graphical_culture = uma_fallen_empire
							#						save_event_target_as = goldshi
							set_country_flag = naka_crisis_country
							set_aggro_range = 1000
							set_aggro_range_measure_from = self
						}
					}

					event_target:naka_crisis_country = {
						create_fleet = {
							name = "NAME_Naka_Portal"
							effect = {
								set_owner = PREV
								create_ship = {
									design = "NAME_Unbidden_Portal"
									graphical_culture = "extra_dimensional_01"
									effect = {
										set_ship_flag = naka_portal
									}
								}
								set_location = {
									target = PrevPrev
									distance = 50
									angle = random
								}
								save_global_event_target_as = naka_portal
								set_global_flag = uma_nakayamas_portal_still_here
								set_event_locked = yes #击破不能
							}
						}
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_constructor_creator_naka = yes #建造船
						uma_mid_crisis_constructor_creator_naka = yes #建造船
						country_event = { id = uma_crisis.521 days = 200 }
					}
				}
				if = {
					limit = { exists = starbase }
					starbase = { fleet = { destroy_fleet = this } }
				}
				create_starbase = {
					size = starbase_exd
					owner = event_target:nakayama_crisis_country
				}
				star = {
					create_ambient_object = {
						type = "extradimensional_2"
						location = this
					}
					last_created_ambient_object = {
						set_ambient_object_flag = Nakayama_system_effect_2
						save_event_target_as = Nakayama_system_effect_2
						set_location = {
							target = prev
							distance = 0
							angle = random
						}
					}
				}

			}
			every_playable_country = {
				limit = {
					is_ai = no
				}
				country_event = { id = uma_crisis.2008 }
			}
		}
	}
}

#第二裂隙
country_event = {
	id = uma_crisis.2008
	title = "uma_crisis.1008.name"
	desc = "uma_crisis.2008.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_alien_signal

	is_triggered_only = yes

	option = {
		name = uma_crisis.2008.a
		hidden_effect = {
			owner = {
				country_event = { id = uma_crisis.3000 days = 180 }
				country_event = { id = uma_crisis.20081 days = 70 }
				country_event = { id = uma_crisis.2009 }
			}
		}
	}
}

country_event = {
	id = uma_crisis.2009
	title = "TRANSMISSION"
	desc = uma_crisis.2009.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}
	immediate = {
	}
	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}
	option = {
		name = uma_crisis.2009.a
		hidden_effect = {
			owner = {
				country_event = { id = uma_crisis.2010 }
			}
		}
	}
}

country_event = {
	id = uma_crisis.2010
	title = "TRANSMISSION"
	desc = uma_crisis.2010.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}
	immediate = {
	}
	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}
	option = {
		name = "END_TRANSMISSION"
	}
}

#通常通讯（中山庆典）
country_event = {
	id = uma_crisis.112
	title = "TRANSMISSION"
	desc = uma_crisis.112.1.desc
	desc = uma_crisis.112.2.desc
	desc = uma_crisis.112.3.desc
	desc = uma_crisis.112.4.desc
	desc = uma_crisis.112.5.desc
	is_triggered_only = yes
	trigger = {
		FROM = {
			is_country_type =nakayamasentai
		}
	}

	diplomatic = yes
	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}


	option = {
		name = uma_crisis.112.a
		hidden_effect = {
			owner = {
				country_event = {
					id = uma_crisis.1121
				}
			}
		}
	}

	option = {
		name = uma_crisis.112.b
	}

	option = {
		name = uma_crisis.112.c
		response_text = uma_crisis.112.c.response
	}
}

country_event = {
	id = uma_crisis.1121
	title = "TRANSMISSION"
	desc = uma_crisis.1121.desc
	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}
	option = {
		name = uma_crisis.1121.a
		hidden_effect = {
			owner = {
				country_event = { id = uma_crisis.1122 }
			}
		}
	}
}

country_event = {
	id = uma_crisis.1122
	title = "TRANSMISSION"
	desc = uma_crisis.1122.desc
	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}
	option = {
		name = uma_crisis.1122.a
		response_text = uma_crisis.1122.a.response
	}
}

#黄金船与中山庆典
country_event = {
	id = uma_crisis.20081
	title = "TRANSMISSION"
	desc = uma_crisis.20081.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}
	immediate = {
		event_target:goldshipsentai = {
			set_faction_hostility = {
				target = event_target:naka_crisis_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
		event_target:nakayamasentai = {
			set_faction_hostility = {
				target = event_target:goldship_crisis_country
				set_hostile = yes
				set_neutral = no
				set_friendly = no
			}
		}
	}
	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}
	option = {
		name = uma_crisis.20081.a
		hidden_effect = {
			owner = {
				country_event = { id = uma_crisis.20082 }
			}
		}
	}
}

country_event = {
	id = uma_crisis.20082
	title = "TRANSMISSION"
	desc = uma_crisis.20082.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}
	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}
	option = {
		name = "END_TRANSMISSION"
	}
}

#中山造船循环
country_event = {
	id = uma_crisis.521
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_global_flag = uma_gold_invasion_happened
		has_global_flag = uma_nakayamas_portal_still_here
	}

	immediate = {
		event_target:naka_crisis_country = {
			# 如果船的战力很强，打破，check later
			if = {
				limit = {
					fleet_power > 10000
				}
				country_event = { id = uma_crisis.521 days = 200 }
				break = yes
			}
			uma_mid_crisis_ship_creator_naya = yes
			uma_mid_crisis_constructor_creator_naka = yes
			country_event = { id = uma_crisis.521 days = 200 }
		}
	}
}






country_event = {
	id = uma_crisis.3000
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		#Portal Holder
		create_country = {
			name = "NAME_Orfevre_Portal_Holder"
			type = portal_holder
			flag = {
				icon = {
					category = "uiu_flags"
					file = "uiu_flags01.dds"
				}
				background = {
					category = "backgrounds"
					file = "circle.dds"
				}
				colors = {
					"indigo"
					"blue"
					"null"
					"null"
				}
			}
			effect = {
				save_global_event_target_as = Orfevre_portal_holder
				every_playable_country = {
					establish_communications_no_message = event_target:Orfevre_portal_holder
				}
			}
		}

		random_system = {
			limit = {
				has_star_flag = uma_gold_invasion_spawn_system
			}
			random_neighbor_system = {
				limit = {
					NOR = {
						has_star_flag = uma_naka_invasion_spawn_system
						is_capital_system = yes
						is_star_class = sc_pulsar
						is_star_class = sc_binary_1
						AND = {
							exists = owner
							owner = {
								OR = {
									is_country_type = fallen_empire
									is_country_type = awakened_fallen_empire
								}
							}
						}

					}
				}
				set_star_flag = uma_Orfevre_invasion_spawn_system
				save_event_target_as = uma_Orfevre_invasion_spawn_system

				random_system_planet = {
					create_species = {
						name = "NAME_Orfevre_species"
						class = umamusume
						namelist = UMAname
						portrait = umamusume
						traits = random
						effect = { save_event_target_as = nakayama_species }
					}

					create_country = {
						name = "NAME_Orfevre"
						type = "orfevresentai"
						species = event_target:nakayama_species
						name_list = "UMAname"
						flag = {
							icon = {
								category = "uiu_flags"
								file = "uiu_flags01.dds"
							}
							background = {
								category = "backgrounds"
								file = "circle.dds"
							}
							colors = {
								"indigo"
								"blue"
								"null"
								"null"
							}
						}
						effect = {
							create_ship_design = { design = "NAME_Void_Shaper" }
							add_ship_design = last_created_design
							create_ship_design = { design = "NAME_Unbidden_Anchor" }
							add_ship_design = last_created_design
							create_ship_design = { design = "NAME_Unbidden_Starbase" }
							add_ship_design = last_created_design
							save_global_event_target_as = Orfevre_crisis_country
							establish_communications_no_message = event_target:Orfevre_portal_holder
							set_faction_hostility = {
								target = event_target:Orfevre_portal_holder
								set_hostile = no
							}
							set_faction_hostility = {
								target = event_target:goldship_crisis_country
								set_friendly = yes
								set_hostile = no
							}
							set_faction_hostility = {
								target = event_target:naka_crisis_country
								set_friendly = yes
								set_hostile = no
							}
							set_aggro_range = 1000
							set_aggro_range_measure_from = self
							set_graphical_culture = uma_fallen_empire
							#						save_event_target_as = goldshi
							set_country_flag = Orfevre_crisis_country
						}
					}

					event_target:Orfevre_crisis_country = {
						create_fleet = {
							name = "NAME_Orfevre_Portal"
							effect = {
								set_fleet_flag = uma_Orfevre_portal_fleet_flag
								set_owner = PREV
								create_ship = {
									design = "NAME_Unbidden_Portal"
									graphical_culture = "extra_dimensional_01"
									effect = {
										set_ship_flag = Orfevre_portal
									}
								}
								set_location = {
									target = PrevPrev
									distance = 50
									angle = random
								}
								save_global_event_target_as = Orfevre_portal
								set_global_flag = uma_Orfevre_portal_still_here
								set_event_locked = yes #击破不能
							}
						}
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_ship_creator_naya = yes #舰队创建
						uma_mid_crisis_constructor_creator_naka = yes #建造船
						uma_mid_crisis_constructor_creator_naka = yes #建造船
						country_event = { id = uma_crisis.522 days = 200 }
					}
				}
				if = {
					limit = { exists = starbase }
					starbase = { fleet = { destroy_fleet = this } }
				}
				create_starbase = {
					size = starbase_exd
					owner = event_target:Orfevre_crisis_country
				}
				star = {
					create_ambient_object = {
						type = "extradimensional_2"
						location = this
					}
					last_created_ambient_object = {
						set_ambient_object_flag = Orfevre_system_effect_2
						save_event_target_as = Orfevre_system_effect_2
						set_location = {
							target = prev
							distance = 0
							angle = random
						}
					}
				}

			}
			every_playable_country = {
				limit = {
					is_ai = no
				}
				country_event = { id = uma_crisis.3008 }
			}
		}
	}
}

#巨匠造船循环
country_event = {
	id = uma_crisis.522
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_global_flag = uma_gold_invasion_happened
		has_global_flag = uma_Orfevre_portal_still_here
	}

	immediate = {
		event_target:Orfevre_crisis_country = {
			# 如果船的战力很强，打破，check later
			if = {
				limit = {
					fleet_power > 10000
				}
				country_event = { id = uma_crisis.522 days = 200 }
				break = yes
			}
			uma_mid_crisis_ship_creator_Orfevre = yes
			uma_mid_crisis_constructor_creator_Orfevre = yes
			country_event = { id = uma_crisis.522 days = 200 }
		}
	}
}

#第三裂隙
country_event = {
	id = uma_crisis.3008
	title = "uma_crisis.1008.name"
	desc = "uma_crisis.3008.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_alien_signal

	is_triggered_only = yes
	immediate = {
		set_faction_hostility = {
			target = event_target:goldship_crisis_country
			set_hostile = yes
		}
		set_faction_hostility = {
			target = event_target:naka_crisis_country
			set_hostile = yes
		}
		set_faction_hostility = {
			target = event_target:Orfevre_crisis_country
			set_hostile = yes
		}
	}

	option = {
		name = uma_crisis.3008.a
		hidden_effect = {
			owner = {
				country_event = { id = uma_crisis.3009 }
			}
		}
	}
}

country_event = {
	id = uma_crisis.3009
	title = "TRANSMISSION"
	desc = uma_crisis.3009.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}
	immediate = {
	}
	picture_event_data = {
		portrait = "OF"
		room = uma_shoping_center_room
	}
	option = {
		name = uma_crisis.2009.a
		hidden_effect = {
			owner = {
				country_event = { id = uma_crisis.3010 }
			}
		}
	}
}

country_event = {
	id = uma_crisis.3010
	title = "TRANSMISSION"
	desc = uma_crisis.3010.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}
	immediate = {
	}
	picture_event_data = {
		portrait = "OF"
		room = uma_shoping_center_room
	}
	option = {
		name = "END_TRANSMISSION"
	}
}


#通常通讯（黄金巨匠）
country_event = {
	id = uma_crisis.113
	title = "TRANSMISSION"
	desc = uma_crisis.113.1.desc
	desc = uma_crisis.113.2.desc
	desc = uma_crisis.113.3.desc
	diplomatic = yes
	is_triggered_only = yes

	trigger = {
		FROM = {
			is_country_type = orfevresentai
		}
	}

	picture_event_data = {
		portrait = "OF"
		room = uma_shoping_center_room
	}


	option = {
		name = uma_crisis.113.a
		response_text = uma_crisis.113.a.response
	}
}











country_event = {
	id = uma_crisis.111
	title = "TRANSMISSION"
	desc = uma_crisis.111.1.desc
	desc = uma_crisis.111.2.desc
	desc = uma_crisis.111.3.desc
	desc = uma_crisis.111.4.desc
	desc = uma_crisis.111.5.desc
	desc = uma_crisis.111.6.desc
	desc = uma_crisis.111.7.desc
	desc = uma_crisis.111.8.desc
	desc = uma_crisis.111.9.desc
	desc = uma_crisis.111.10.desc
	is_triggered_only = yes
	trigger = {
		FROM = {
			is_country_type = goldshipsentai
		}
	}

	diplomatic = yes
	picture_event_data = {
		portrait = "07c"
		room = uma_shoping_center_room
	}


	option = {
		name = uma_crisis.111.a
		response_text = uma_crisis.111.a.response
		is_dialog_only = yes
	}

	option = {
		name = uma_crisis.111.b
		response_text = uma_crisis.111.b.response
		is_dialog_only = yes
	}

	option = {
		name = uma_crisis.111.c
		response_text = uma_crisis.111.c.response
		is_dialog_only = yes
	}

	option = {
		name = uma_crisis.111.d
		response_text = uma_crisis.111.d.response
		is_dialog_only = yes
	}
	option = {
		name = "END_TRANSMISSION"
	}
}





country_event = {
	id = uma_crisis.667
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		AND = {
			NOT = {
				has_global_flag = uma_gold_invasion_change
			}
			has_global_flag = uma_gold_invasion_happened
			OR = {
				num_killed_ships = {
					target = event_target:goldship_crisis_country
					value >= 600
				}
				num_killed_ships = {
					target = event_target:naka_crisis_country
					value >= 600
				}
				num_killed_ships = {
					target = event_target:Orfevre_crisis_country
					value >= 600
				}
			}
		}
	}

	immediate = {
		country_event = {
			id = uma_crisis.11200
		}
	}
}


#中山庆典的秘密通讯

country_event = {
	id = uma_crisis.11200
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		AND = {
			NOT = {
				has_global_flag = uma_gold_invasion_change
			}
			has_global_flag = uma_gold_invasion_happened
			OR = {
				num_killed_ships = {
					target = event_target:goldship_crisis_country
					value >= 600
				}
				num_killed_ships = {
					target = event_target:naka_crisis_country
					value >= 600
				}
				num_killed_ships = {
					target = event_target:Orfevre_crisis_country
					value >= 600
				}
			}
		}
	}
	immediate = {
		set_global_flag = uma_gold_invasion_change
		set_faction_hostility = {
			target = event_target:naka_crisis_country
			set_neutral = yes
			set_hostile = no
		}
		event_target:naka_crisis_country = {
			set_faction_hostility = {
				target = event_target:uma_player_umamusume_empire
				set_neutral = yes
			}
		}
		country_event = {
			id = uma_crisis.11201
		}
	}
}

country_event = {
	id = uma_crisis.11201
	title = "TRANSMISSION"
	desc = uma_crisis.11201.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}

	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}

	option = {
		name = uma_crisis.11201.a
		hidden_effect = {
			country_event = { id = uma_crisis.11202 }
		}
	}
}

country_event = {
	id = uma_crisis.11202
	title = "TRANSMISSION"
	desc = uma_crisis.11202.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}

	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}

	option = {
		name = uma_crisis.11202.a
		hidden_effect = {
			country_event = { id = uma_crisis.11203 }
		}
	}
}

country_event = {
	id = uma_crisis.11203
	title = "TRANSMISSION"
	desc = uma_crisis.11203.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}

	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}

	option = {
		name = uma_crisis.11203.a
		hidden_effect = {
			country_event = { id = uma_crisis.11204 }
		}
	}
}

country_event = {
	id = uma_crisis.11204
	title = "TRANSMISSION"
	desc = uma_crisis.11204.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}

	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}

	option = {
		name = uma_crisis.11204.a
		hidden_effect = {
			country_event = { id = uma_crisis.11205 }
		}
	}
}

country_event = {
	id = uma_crisis.11205
	title = "TRANSMISSION"
	desc = uma_crisis.11205.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
	}

	picture_event_data = {
		portrait = "NY"
		room = uma_shoping_center_room
	}

	option = {
		name = "END_TRANSMISSION"
		hidden_effect = {
			country_event = { id = uma_crisis.11206 }
		}
	}
}

country_event = {
	id = uma_crisis.11206
	title = uma_crisis.11206.title
	desc = uma_crisis.11206.desc
	picture = GFX_evt_mysterious_signal
	is_triggered_only = yes
	trigger = {
	}

	immediate = {
		#解锁
		event_target:Orfevre_portal = {
			set_event_locked = no
		}
		event_target:gold_ship_portal = {
			set_event_locked = no
		}
		set_global_flag = uma_gold_crisis_control
	}

	option = {
		name = uma_crisis.11206.a
	}
}

#黄金船的传送门被毁
country_event = {
	id = uma_crisis.1020
	title = "TRANSMISSION"
	desc = uma_crisis.1020.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
		has_global_flag = uma_gold_crisis_control
		from = {
			has_country_flag = gold_ship_crisis_country
		}
		fromfromfrom = {
			has_fleet_flag = gold_ship_portal_fleet
		}
	}

	picture_event_data = {
		portrait = GS
	}

	immediate = {
		from = {
			every_owned_fleet = {
				destroy_fleet = this
			}
			destroy_country = yes
		}
		remove_global_flag = uma_gold_ships_portal_still_here
	}

	option = {
		name = uma_crisis.1020.a
		country_event = {
			id = uma_crisis.6000
			days = 100
		}
		hidden_effect = {
			destroy_ambient_object = event_target:Goldship_system_effect_2
		}
	}
}

#黄金巨匠的传送门被毁
country_event = {
	id = uma_crisis.2020
	title = "TRANSMISSION"
	desc = uma_crisis.2020.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
		has_global_flag = uma_gold_crisis_control
		from = {
			has_country_flag = Orfevre_crisis_country
		}
		fromfromfrom = {
			has_fleet_flag = uma_Orfevre_portal_fleet_flag
		}
	}

	picture_event_data = {
		portrait = "OF"
	}

	immediate = {
		from = {
			every_owned_fleet = {
				destroy_fleet = this
			}
			destroy_country = yes
		}
		remove_global_flag = uma_Orfevre_portal_still_here
	}

	option = {
		name = uma_crisis.2020.a
		country_event = {
			id = uma_crisis.6000
			days = 100
		}
		hidden_effect = {
			destroy_ambient_object = event_target:Orfevre_system_effect_2
		}
	}
}



#双方传送门均被毁
country_event = {
	id = uma_crisis.6000
	title = uma_crisis.6000.title
	desc = uma_crisis.6000.desc
	is_triggered_only = yes
	trigger = {
		NOT = {
			AND = {
				has_global_flag = uma_Orfevre_portal_still_here
				has_global_flag = uma_gold_ships_portal_still_here
			}
		}
	}

	immediate = {

	}
	option = {
		name = uma_crisis.6000.1.a
		owner = {
			country_event = { id = uma_crisis.6010 }
		}
	}
	option = {
		name = uma_crisis.6000.2.a
		owner = {
			country_event = { id = uma_crisis.6020 }
		}
	}
}
#黄金舰队的转进
country_event = {
	id = uma_crisis.6010
	title = "TRANSMISSION"
	desc = uma_crisis.6010.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
		owner = {
			has_country_flag = is_uma_country_flag
		}
	}

	picture_event_data = {
		portrait = "NY"
	}

	immediate = {
	}
	option = {
		name = uma_crisis.6010.1.a
		owner = {
			country_event = { id = uma_crisis.6050 }
		}
	}
}

country_event = {
	id = uma_crisis.6020
	title = "TRANSMISSION"
	desc = uma_crisis.6020.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
		owner = {
			has_country_flag = is_uma_country_flag
		}
	}

	picture_event_data = {
		portrait = "NY"
	}

	immediate = {
	}
	option = {
		name = uma_crisis.6020.1.a
		owner = {
			country_event = { id = uma_crisis.6021 }
		}
	}
}
country_event = {
	id = uma_crisis.6021
	title = "TRANSMISSION"
	desc = uma_crisis.6021.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
		owner = {
			has_country_flag = is_uma_country_flag
		}
	}

	picture_event_data = {
		portrait = "NY"
	}

	immediate = {
	}
	option = {
		name = uma_crisis.6021.1.a
		owner = {
			country_event = { id = uma_crisis.6022 }
		}
	}
}
country_event = {
	id = uma_crisis.6022
	title = "TRANSMISSION"
	desc = uma_crisis.6022.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
		owner = {
			has_country_flag = is_uma_country_flag
		}
	}

	picture_event_data = {
		portrait = "NY"
	}

	immediate = {
	}
	option = {
		name = uma_crisis.6022.1.a
		owner = {
			country_event = { id = uma_crisis.6023 }
		}
	}
}
country_event = {
	id = uma_crisis.6023
	title = "TRANSMISSION"
	desc = uma_crisis.6023.desc
	is_triggered_only = yes
	diplomatic = yes
	trigger = {
		owner = {
			has_country_flag = is_uma_country_flag
		}
	}

	picture_event_data = {
		portrait = "NY"
	}

	immediate = {
	}
	option = {
		name = "END_TRANSMISSION"
		owner = {
			country_event = { id = uma_crisis.6050 }
		}
	}
}
#隧道
country_event = {
	id = uma_crisis.6050
	title = uma_crisis.6050.title
	desc = uma_crisis.6050.desc
	picture = GFX_evt_crisis_defeated

	is_triggered_only = yes
	trigger = {}

	immediate = {
		event_target:naka_portal = {
			set_event_locked = no
		}
		random_country = {
			limit = {
				is_country_type = nakayamasentai
			}
			every_owned_fleet = {
				destroy_fleet = this
			}
			destroy_country = yes
		}
		event_target:naka_portal_holder = {
			every_owned_fleet = {
				destroy_fleet = this
			}
			every_owned_ship = {
				destroy_ship = this
			}
			destroy_country = yes
		}

	}
	option = {
		name = uma_crisis.6050.a
		remove_global_flag = uma_gold_invasion_happened
	}
	after = {
		hidden_effect = {
			remove_global_flag = uma_gold_crisis_control
			end_event_chain = gold_counterattack
#			event_target:uma_naka_invasion_spawn_system = {
#				spawn_natural_wormhole = {
#					bypass_type = uma_gold_tunnel
#					orbit_distance = 200
#					orbit_angle =random
#					random_pos = yes
#				}
#			}
#			set_faction_hostility = {
#				target = event_target:uma_gold_invasion_family_country
#				set_neutral = yes
#			}
#			country_event = {
#				id = uma_crisis.5998
#				days = 3500
#			}
		}
	}
}



##Part2


##星系生成器！！
#country_event = {
#	id = uma_crisis.2077
#	hide_window = yes
#	is_triggered_only = yes
#
#	immediate = {
#		if = {
#			limit = { count_system = { count <= 250 } } #200
#			no_scope = {
#				spawn_system = {
#					min_distance >= 105
#					max_distance <= 215
#					min_orientation_angle = 160
#					max_orientation_angle = 200
#					initializer = "uma_gold_system_initializer"
#					hyperlane = no
#				}
#			}
#		}
#
#		else_if = {
#			limit = { count_system = { count <= 450 } }
#			no_scope = {
#				spawn_system = {
#					min_distance >= 325
#					max_distance <= 335
#					min_orientation_angle = 160
#					max_orientation_angle = 200
#					initializer = "uma_gold_system_initializer"
#					hyperlane = no
#				}
#			}
#		}
#
#		else_if = {
#			limit = { count_system = { count <= 650 } }
#			no_scope = {
#				spawn_system = {
#					min_distance >= 415
#					max_distance <= 425
#					min_orientation_angle = 160
#					max_orientation_angle = 200
#					initializer = "uma_gold_system_initializer"
#					hyperlane = no
#				}
#			}
#		}
#
#		else_if = {
#			limit = { count_system = { count <= 850 } }
#			no_scope = {
#				spawn_system = {
#					min_distance >= 445
#					max_distance <= 455
#					min_orientation_angle = 160
#					max_orientation_angle = 200
#					initializer = "uma_gold_system_initializer"
#					hyperlane = no
#				}
#			}
#		}
#
#		else = {
#			no_scope = {
#				spawn_system = {
#					min_distance >= 475
#					max_distance <= 485
#					min_orientation_angle = 160
#					max_orientation_angle = 200
#					initializer = "uma_gold_system_initializer"
#					hyperlane = no
#				}
#			}
#		}
#	}
#	after = {
#		random_system = {
#			limit = {
#				has_star_flag = uma_gold_invasion_system
#			}
#			save_global_event_target_as = uma_gold_invasion_system_here
#		}
#	}
#}
#
##当通过虫洞时
#fleet_event = {
#	id = uma_crisis.5999
#	hide_window = yes
#	is_triggered_only = yes
#
#	immediate = {
#		set_global_flag = uma_entered_the_gold_protal
#	}
#}
##3500日后
#country_event = {
#	id = uma_crisis.5998
#	hide_window = yes
#	is_triggered_only = yes
#
#	trigger = {
#		NOT = {
#			has_global_flag = uma_entered_the_gold_protal
#		}
#	}
#
#	immediate = {
#		set_global_flag = uma_gold_hole_time_out
#	}
#}
#
#
#ship_event = {
#	id = uma_crisis.6660
#	hide_window = yes
#	is_triggered_only = yes
#
#	immediate = {
#		fromfrom = {
#			country_event = {
#				id = uma_crisis.6661
#			}
#		}
#	}
#}
#
#country_event = {
#	id = uma_crisis.6661
#	title = TRANSMISSION
#	desc = uma_crisis.6661.desc
#	diplomatic = yes
#	is_triggered_only = yes
#
#	picture_event_data = {
#		room = no_video_feed_room
#	}
#
#	option = {
#		name = uma_crisis.6661.a
#	}
#
#	option = {
#		name = uma_crisis.6661.a
#	}
#}
#
#country_event = {
#	id = uma_crisis.6662
#	title = TRANSMISSION
#	desc = uma_crisis.6662.desc
#	diplomatic = yes
#	is_triggered_only = yes
#
#	picture_event_data = {
#		room = no_video_feed_room
#	}
#
#	option = {
#		name = uma_crisis.6662.a
#	}
#
#	option = {
#		name = uma_crisis.6662.a
#	}
#}
#
#country_event = {
#	id = uma_crisis.6663
#	title = TRANSMISSION
#	desc = uma_crisis.6663.desc
#	diplomatic = yes
#	is_triggered_only = yes
#
#	picture_event_data = {
#		room = no_video_feed_room
#	}
#
#	option = {
#		name = uma_crisis.6663.a
#	}
#
#	option = {
#		name = uma_crisis.6663.a
#	}
#}
#
#country_event = {
#	id = uma_crisis.6664
#	title = TRANSMISSION
#	desc = uma_crisis.6664.desc
#	diplomatic = yes
#	is_triggered_only = yes
#
#	picture_event_data = {
#		room = no_video_feed_room
#	}
#
#	option = {
#		name = uma_crisis.6664.a
#	}
#
#	option = {
#		name = uma_crisis.6664.a
#	}
#}